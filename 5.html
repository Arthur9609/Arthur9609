<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¶ˆé™¤é£¢é¤“å¤§ä½œæˆ° - å…¨çƒç³§é£Ÿå¹³è¡¡ï¼ˆç¬¬5é—œï¼‰</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
            background-image: url('https://images.unsplash.com/photo-1498837167922-ddd27525d352');
            background-size: cover;
            background-position: center;
            color: #333;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #game-container {
            max-width: 900px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        h1 {
            color: #e74c3c;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #2c3e50;
            font-size: 18px;
            margin-bottom: 20px;
        }
        
        #world-map {
            position: relative;
            width: 100%;
            height: 400px;
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/World_map_-_low_resolution.svg/1200px-World_map_-_low_resolution.svg.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            margin: 20px 0;
        }
        
        .country {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: rgba(231, 76, 60, 0.7);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }
        
        .country:hover {
            transform: scale(1.2);
            background-color: rgba(231, 76, 60, 0.9);
        }
        
        #stats {
            display: flex;
            justify-content: space-around;
            margin: 25px 0;
            font-size: 20px;
            font-weight: bold;
            background-color: rgba(46, 204, 113, 0.2);
            padding: 15px;
            border-radius: 10px;
        }
        
        .stat {
            display: flex;
            flex-direction: column;
        }
        
        .stat-value {
            font-size: 24px;
            color: #e74c3c;
        }
        
        #message {
            min-height: 40px;
            color: #e74c3c;
            font-weight: bold;
            margin: 15px 0;
            font-size: 18px;
        }
        
        #resource-panel {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        
        .resource {
            width: 80px;
            height: 80px;
            background-color: white;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 5px;
        }
        
        .resource:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }
        
        .resource-icon {
            font-size: 30px;
            margin-bottom: 5px;
        }
        
        .resource-amount {
            font-size: 14px;
            font-weight: bold;
        }
        
        button {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px;
        }
        
        button:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        #music-control {
            margin-top: 20px;
        }
        
        #game-over {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 100;
            flex-direction: column;
            color: white;
        }
        
        #game-over h2 {
            font-size: 40px;
            color: #f1c40f;
            margin-bottom: 20px;
        }
        
        .progress-container {
            width: 80%;
            height: 30px;
            background-color: #ecf0f1;
            border-radius: 15px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: #2ecc71;
            width: 0%;
            transition: width 0.5s;
        }
        
        #restart-btn-container {
            position: absolute;
            top: 20px;
            right: 20px;
        }
        
        #restart-btn {
            background-color: #3498db;
            padding: 8px 15px;
            font-size: 14px;
        }
        
        #restart-btn:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="restart-btn-container">
            <button id="restart-btn">â†» é‡æ–°é–‹å§‹</button>
        </div>
        
        <h1>æ¶ˆé™¤é£¢é¤“å¤§ä½œæˆ°</h1>
        <div class="subtitle">å…¨çƒç³§é£Ÿå¹³è¡¡ - ç¬¬5é—œ</div>
        <p>åˆ†é…ç³§é£Ÿè³‡æºåˆ°é£¢é¤“åœ°å€ï¼Œé”æˆå…¨çƒç³§é£Ÿå¹³è¡¡ï¼</p>
        
        <div id="stats">
            <div class="stat">
                <div>å‰©é¤˜æ™‚é–“</div>
                <div class="stat-value" id="time">120</div>
            </div>
            <div class="stat">
                <div>ç³§é£Ÿå¹³è¡¡åº¦</div>
                <div class="stat-value" id="balance">0%</div>
            </div>
            <div class="stat">
                <div>å¹«åŠ©åœ‹å®¶</div>
                <div class="stat-value" id="countries">0/10</div>
            </div>
        </div>
        
        <div id="message">é»æ“Šé–‹å§‹éŠæˆ²æŒ‰éˆ•ï¼Œåˆ†é…è³‡æºåˆ°åœ°åœ–ä¸Šçš„é£¢é¤“åœ°å€</div>
        
        <div id="resource-panel">
            <div class="resource" id="resource1" data-type="train">
                <div class="resource-icon">ğŸš‚</div>
                <div>é‹è¼¸ç³»çµ±</div>
                <div class="resource-amount">x <span id="train-amount">3</span></div>
            </div>
            <div class="resource" id="resource2" data-type="money">
                <div class="resource-icon">ğŸ’°</div>
                <div>è³‡é‡‘æ´åŠ©</div>
                <div class="resource-amount">x <span id="money-amount">5</span></div>
            </div>
            <div class="resource" id="resource3" data-type="food">
                <div class="resource-icon">ğŸŒ¾</div>
                <div>ç³§é£Ÿæ´åŠ©</div>
                <div class="resource-amount">x <span id="food-amount">8</span></div>
            </div>
            <div class="resource" id="resource4" data-type="tech">
                <div class="resource-icon">ğŸ“±</div>
                <div>è¾²æ¥­æŠ€è¡“</div>
                <div class="resource-amount">x <span id="tech-amount">4</span></div>
            </div>
        </div>
        
        <div id="world-map"></div>
        
        <button id="start-btn">é–‹å§‹éŠæˆ²</button>
        
        <div id="music-control">
            <button id="music-toggle">èƒŒæ™¯éŸ³æ¨‚: é—œé–‰</button>
        </div>
    </div>
    
    <div id="game-over">
        <h2 id="result-title">éŠæˆ²çµæŸ</h2>
        <div id="result-message"></div>
        <div class="progress-container">
            <div class="progress-bar" id="result-progress"></div>
        </div>
        <div id="result-stats"></div>
        <button id="restart-end-btn">å†ç©ä¸€æ¬¡</button>
    </div>
    
    <audio id="bg-music" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3" type="audio/mpeg">
        æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æŒéŸ³é »å…ƒç´ ã€‚
    </audio>
    
    <audio id="success-sound">
        <source src="https://www.soundjay.com/buttons/sounds/button-21.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="fail-sound">
        <source src="https://www.soundjay.com/buttons/sounds/button-10.mp3" type="audio/mpeg">
    </audio>
    
    <script>
        // éŠæˆ²æ•¸æ“š
        const countries = [
            { name: "éæ´²", x: 50, y: 60, needed: ["food", "tech", "money"] },
            { name: "å—äº", x: 75, y: 50, needed: ["food", "train", "money"] },
            { name: "ä¸­æ±", x: 65, y: 40, needed: ["tech", "money"] },
            { name: "å—ç¾", x: 30, y: 70, needed: ["food", "tech"] },
            { name: "æ±å—äº", x: 80, y: 55, needed: ["food", "train", "tech"] },
            { name: "ä¸­ç¾æ´²", x: 20, y: 55, needed: ["food", "money"] },
            { name: "æ±æ­", x: 60, y: 30, needed: ["tech", "train"] },
            { name: "å¤ªå¹³æ´‹å³¶åœ‹", x: 90, y: 70, needed: ["food", "money", "tech"] },
            { name: "ä¸­äº", x: 70, y: 35, needed: ["train", "tech"] },
            { name: "åŠ å‹’æ¯”æµ·", x: 25, y: 60, needed: ["food", "money"] }
        ];
        
        // éŠæˆ²ç‹€æ…‹
        let gameState = {
            timeLeft: 120,
            balance: 0,
            helpedCountries: 0,
            resources: {
                train: 3,
                money: 5,
                food: 8,
                tech: 4
            },
            selectedResource: null,
            isGameRunning: false,
            timer: null,
            countryElements: []
        };
        
        // DOMå…ƒç´ 
        const worldMap = document.getElementById('world-map');
        const timeDisplay = document.getElementById('time');
        const balanceDisplay = document.getElementById('balance');
        const countriesDisplay = document.getElementById('countries');
        const messageDisplay = document.getElementById('message');
        const startBtn = document.getElementById('start-btn');
        const musicToggle = document.getElementById('music-toggle');
        const bgMusic = document.getElementById('bg-music');
        const successSound = document.getElementById('success-sound');
        const failSound = document.getElementById('fail-sound');
        const gameOverScreen = document.getElementById('game-over');
        const resultTitle = document.getElementById('result-title');
        const resultMessage = document.getElementById('result-message');
        const resultProgress = document.getElementById('result-progress');
        const resultStats = document.getElementById('result-stats');
        const restartEndBtn = document.getElementById('restart-end-btn');
        const restartBtn = document.getElementById('restart-btn');
        
        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            // é‡ç½®éŠæˆ²ç‹€æ…‹
            gameState = {
                timeLeft: 120,
                balance: 0,
                helpedCountries: 0,
                resources: {
                    train: 3,
                    money: 5,
                    food: 8,
                    tech: 4
                },
                selectedResource: null,
                isGameRunning: false,
                timer: null,
                countryElements: []
            };
            
            // æ›´æ–°UI
            updateUI();
            messageDisplay.textContent = "é¸æ“‡ä¸€ç¨®è³‡æºï¼Œç„¶å¾Œé»æ“Šåœ°åœ–ä¸Šçš„åœ‹å®¶é€²è¡Œæ´åŠ©";
            startBtn.textContent = "é–‹å§‹éŠæˆ²";
            startBtn.disabled = false;
            
            // æ¸…é™¤åœ°åœ–ä¸Šçš„åœ‹å®¶
            worldMap.innerHTML = '';
            
            // æ¸…é™¤è³‡æºé¸æ“‡ç‹€æ…‹
            document.querySelectorAll('.resource').forEach(res => {
                res.style.boxShadow = 'none';
            });
            
            // å‰µå»ºåœ‹å®¶å…ƒç´ 
            countries.forEach((country, index) => {
                const countryElement = document.createElement('div');
                countryElement.className = 'country';
                countryElement.style.left = `${country.x}%`;
                countryElement.style.top = `${country.y}%`;
                countryElement.dataset.index = index;
                countryElement.textContent = 'ğŸŒ';
                countryElement.addEventListener('click', () => helpCountry(index));
                worldMap.appendChild(countryElement);
                gameState.countryElements.push(countryElement);
            });
        }
        
        // é–‹å§‹éŠæˆ²
        function startGame() {
            if (gameState.isGameRunning) return;
            
            initGame();
            gameState.isGameRunning = true;
            startBtn.textContent = 'éŠæˆ²é€²è¡Œä¸­...';
            startBtn.disabled = true;
            
            // è‡ªå‹•æ’­æ”¾èƒŒæ™¯éŸ³æ¨‚
            bgMusic.play();
            musicToggle.textContent = 'èƒŒæ™¯éŸ³æ¨‚: é—œé–‰';
            isMusicPlaying = true;
            
            // é–‹å§‹è¨ˆæ™‚å™¨
            gameState.timer = setInterval(() => {
                gameState.timeLeft--;
                timeDisplay.textContent = gameState.timeLeft;
                
                if (gameState.timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }
        
        // å¹«åŠ©åœ‹å®¶
        function helpCountry(countryIndex) {
            if (!gameState.isGameRunning || !gameState.selectedResource) return;
            
            const country = countries[countryIndex];
            const countryElement = gameState.countryElements[countryIndex];
            
            // æª¢æŸ¥æ˜¯å¦æ˜¯è©²åœ‹å®¶éœ€è¦çš„è³‡æº
            if (country.needed.includes(gameState.selectedResource)) {
                // æˆåŠŸå¹«åŠ©
                successSound.currentTime = 0;
                successSound.play();
                
                // æ¸›å°‘è³‡æº
                gameState.resources[gameState.selectedResource]--;
                
                // æ›´æ–°åœ‹å®¶ç‹€æ…‹
                countryElement.style.backgroundColor = 'rgba(46, 204, 113, 0.7)';
                countryElement.textContent = getResourceIcon(gameState.selectedResource);
                countryElement.onclick = null; // ç§»é™¤é»æ“Šäº‹ä»¶
                
                // æ›´æ–°éŠæˆ²ç‹€æ…‹
                gameState.helpedCountries++;
                gameState.balance += 10;
                
                // æª¢æŸ¥æ˜¯å¦æ‰€æœ‰éœ€æ±‚éƒ½æ»¿è¶³
                if (isCountryFullyHelped(countryIndex)) {
                    gameState.balance += 5; // é¡å¤–åŠ åˆ†
                    countryElement.style.boxShadow = '0 0 20px #f1c40f';
                    messageDisplay.textContent = `æˆåŠŸå¹«åŠ©${country.name}è§£æ±ºç³§é£Ÿå•é¡Œï¼`;
                } else {
                    messageDisplay.textContent = `å‘${country.name}æä¾›äº†${getResourceName(gameState.selectedResource)}æ´åŠ©`;
                }
                
                // å–æ¶ˆé¸ä¸­çš„è³‡æº
                document.querySelector(`.resource[data-type="${gameState.selectedResource}"]`).style.boxShadow = 'none';
                gameState.selectedResource = null;
                
                // æª¢æŸ¥æ˜¯å¦è´å¾—éŠæˆ²
                if (gameState.helpedCountries >= 10) {
                    endGame(true);
                }
            } else {
                // è³‡æºä¸åŒ¹é…
                failSound.currentTime = 0;
                failSound.play();
                messageDisplay.textContent = `${country.name}ä¸éœ€è¦${getResourceName(gameState.selectedResource)}ï¼Œè«‹é¸æ“‡å…¶ä»–è³‡æº`;
            }
            
            updateUI();
        }
        
        // æª¢æŸ¥åœ‹å®¶æ˜¯å¦å®Œå…¨è¢«å¹«åŠ©
        function isCountryFullyHelped(countryIndex) {
            const country = countries[countryIndex];
            let neededCount = country.needed.length;
            let helpedCount = 0;
            
            // è¨ˆç®—å·²æä¾›çš„è³‡æºç¨®é¡
            for (const resource in gameState.resources) {
                if (!country.needed.includes(resource)) continue;
                if (gameState.resources[resource] < getInitialResource(resource)) {
                    helpedCount++;
                }
            }
            
            return helpedCount >= neededCount;
        }
        
        // ç²å–åˆå§‹è³‡æºæ•¸é‡
        function getInitialResource(resource) {
            const initialResources = { train: 3, money: 5, food: 8, tech: 4 };
            return initialResources[resource];
        }
        
        // ç²å–è³‡æºåç¨±
        function getResourceName(resource) {
            const names = {
                train: 'é‹è¼¸ç³»çµ±',
                money: 'è³‡é‡‘æ´åŠ©',
                food: 'ç³§é£Ÿæ´åŠ©',
                tech: 'è¾²æ¥­æŠ€è¡“'
            };
            return names[resource];
        }
        
        // ç²å–è³‡æºåœ–æ¨™
        function getResourceIcon(resource) {
            const icons = {
                train: 'ğŸš‚',
                money: 'ğŸ’°',
                food: 'ğŸŒ¾',
                tech: 'ğŸ“±'
            };
            return icons[resource];
        }
        
        // æ›´æ–°UI
        function updateUI() {
            timeDisplay.textContent = gameState.timeLeft;
            balanceDisplay.textContent = `${gameState.balance}%`;
            countriesDisplay.textContent = `${gameState.helpedCountries}/10`;
            
            // æ›´æ–°è³‡æºæ•¸é‡
            document.getElementById('train-amount').textContent = gameState.resources.train;
            document.getElementById('money-amount').textContent = gameState.resources.money;
            document.getElementById('food-amount').textContent = gameState.resources.food;
            document.getElementById('tech-amount').textContent = gameState.resources.tech;
        }
        
        // çµæŸéŠæˆ²
        function endGame(isWin = false) {
            clearInterval(gameState.timer);
            gameState.isGameRunning = false;
            
            // é¡¯ç¤ºéŠæˆ²çµæŸç•«é¢
            gameOverScreen.style.display = 'flex';
            
            if (isWin || gameState.balance >= 80) {
                resultTitle.textContent = 'ä»»å‹™æˆåŠŸï¼';
                resultMessage.textContent = 'ä½ æˆåŠŸæ”¹å–„äº†å…¨çƒç³§é£Ÿå¹³è¡¡ï¼';
            } else {
                resultTitle.textContent = 'ä»»å‹™æœªå®Œæˆ';
                resultMessage.textContent = 'ç¹¼çºŒåŠªåŠ›ï¼Œæˆ‘å€‘å¯ä»¥åšå¾—æ›´å¥½ï¼';
            }
            
            // æ›´æ–°é€²åº¦æ¢å’Œçµ±è¨ˆ
            resultProgress.style.width = `${gameState.balance}%`;
            resultStats.innerHTML = `
                <div>å¹«åŠ©åœ‹å®¶: ${gameState.helpedCountries}/10</div>
                <div>ç³§é£Ÿå¹³è¡¡åº¦: ${gameState.balance}%</div>
                <div>å‰©é¤˜æ™‚é–“: ${gameState.timeLeft}ç§’</div>
            `;
        }
        
        // é‡æ–°é–‹å§‹éŠæˆ²
        function restartGame() {
            // åœæ­¢æ‰€æœ‰éŸ³æ•ˆ
            bgMusic.pause();
            successSound.pause();
            failSound.pause();
            
            // éš±è—éŠæˆ²çµæŸç•«é¢ï¼ˆå¦‚æœæ­£åœ¨é¡¯ç¤ºï¼‰
            gameOverScreen.style.display = 'none';
            
            // é‡ç½®éŠæˆ²
            initGame();
        }
        
        // å®Œå…¨é‡æ–°é–‹å§‹éŠæˆ²ï¼ˆåŒ…æ‹¬é–‹å§‹éŠæˆ²ï¼‰
        function fullRestartGame() {
            restartGame();
            startGame();
        }
        
        // éŸ³æ¨‚æ§åˆ¶
        let isMusicPlaying = false;
        musicToggle.addEventListener('click', () => {
            isMusicPlaying = !isMusicPlaying;
            if (isMusicPlaying) {
                bgMusic.play();
                musicToggle.textContent = 'èƒŒæ™¯éŸ³æ¨‚: é—œé–‰';
            } else {
                bgMusic.pause();
                musicToggle.textContent = 'èƒŒæ™¯éŸ³æ¨‚: é–‹å•Ÿ';
            }
        });
        
        // è¨­ç½®è³‡æºé»æ“Šäº‹ä»¶
        document.querySelectorAll('.resource').forEach(resource => {
            resource.addEventListener('click', function() {
                if (!gameState.isGameRunning) return;
                
                const resourceType = this.dataset.type;
                if (gameState.resources[resourceType] > 0) {
                    // å–æ¶ˆä¹‹å‰é¸ä¸­çš„è³‡æº
                    if (gameState.selectedResource) {
                        document.getElementById(`resource${gameState.selectedResource}`).style.boxShadow = 'none';
                    }
                    
                    gameState.selectedResource = resourceType;
                    this.style.boxShadow = '0 0 15px #f1c40f';
                    messageDisplay.textContent = `å·²é¸æ“‡ ${getResourceName(resourceType)}ï¼Œè«‹é»æ“Šéœ€è¦å¹«åŠ©çš„åœ‹å®¶`;
                } else {
                    messageDisplay.textContent = `${getResourceName(resourceType)}å·²ç”¨å®Œï¼`;
                    failSound.currentTime = 0;
                    failSound.play();
                }
            });
        });
        
        // äº‹ä»¶ç›£è½
        startBtn.addEventListener('click', startGame);
        restartEndBtn.addEventListener('click', fullRestartGame);
        restartBtn.addEventListener('click', restartGame);
        
        // åˆå§‹åŒ–éŠæˆ²
        initGame();
    </script>
</body>
</html>