<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¶ˆé™¤é£¢é¤“å¤§ä½œæˆ° - ç¬¬å››é—œï¼šé£Ÿç‰©æ•‘æ´è¡Œå‹•</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            background-image: url('https://images.unsplash.com/photo-1461354464878-ad92f492a5a0?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-attachment: fixed;
            color: #333;
            min-height: 100vh;
        }
        
        #game-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            color: #e74c3c;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        #network-map {
            width: 100%;
            height: 500px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            position: relative;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .node {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
            padding: 5px;
            box-sizing: border-box;
        }
        
        .source {
            background-color: #3498db;
            color: white;
        }
        
        .destination {
            background-color: #e74c3c;
            color: white;
        }
        
        .connection {
            position: absolute;
            height: 3px;
            background-color: #f1c40f;
            transform-origin: 0 0;
            z-index: 1;
        }
        
        #resource-panel {
            background-color: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .resource {
            display: inline-block;
            margin: 5px;
            padding: 8px 15px;
            background-color: #2ecc71;
            color: white;
            border-radius: 20px;
            font-size: 14px;
        }
        
        #score-panel {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            margin: 15px 0;
            text-align: center;
        }
        
        #controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        button {
            padding: 12px 25px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Microsoft JhengHei', sans-serif;
        }
        
        #next-level-btn {
            background-color: #2ecc71;
            color: white;
        }
        
        #next-level-btn:hover {
            background-color: #27ae60;
        }
        
        #restart-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        #restart-btn:hover {
            background-color: #c0392b;
        }
        
        #music-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(255,255,255,0.8);
            padding: 15px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 100;
            font-size: 1.5em;
        }
        
        #level-complete {
            display: none;
            text-align: center;
            padding: 30px;
            background-color: rgba(255,255,255,0.95);
            border-radius: 10px;
            margin-top: 20px;
        }
        
        #level-complete h2 {
            color: #27ae60;
        }
        
        .selected {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.8);
        }
        
        #tutorial {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 16px;
            line-height: 1.6;
        }
        
        #resource-count {
            font-weight: bold;
            color: #e67e22;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>ç¬¬å››é—œï¼šé£Ÿç‰©æ•‘æ´è¡Œå‹•</h1>
        
        <div id="tutorial">
            <p>å»ºç«‹é£Ÿç‰©æ•‘æ´ç¶²çµ¡ï¼Œå°‡<span style="color:#3498db;font-weight:bold">é¤å»³/è¶…å¸‚</span>çš„å¤šé¤˜é£Ÿç‰©é‹é€åˆ°<span style="color:#e74c3c;font-weight:bold">é£Ÿç‰©éŠ€è¡Œ/åº‡è­·æ‰€</span>ï¼</p>
            <p>é»æ“Šé¸æ“‡ä¸€å€‹ä¾†æºé»ï¼Œå†é»æ“Šç›®æ¨™é»å»ºç«‹é€£æ¥ã€‚ä½ ç›®å‰æœ‰ <span id="resource-count">5</span> å€‹é‹è¼¸è³‡æºã€‚</p>
            <p>æ¯å€‹æˆåŠŸé€£æ¥å¯ç²å¾—20åˆ†ï¼Œæ»¿åˆ†100åˆ†å®Œæˆé—œå¡ï¼</p> <!-- ä¿®æ”¹äº†åˆ†æ•¸èªªæ˜ -->
        </div>
        
        <div id="network-map"></div>
        
        <div id="score-panel">
            åˆ†æ•¸: <span id="score-display">0</span>/100 | 
            å·²å»ºç«‹é€£æ¥: <span id="connections-display">0</span> | 
            å‰©é¤˜è³‡æº: <span id="resources-display">5</span>
        </div>
        
        <div id="controls">
            <button id="restart-btn">é‡æ–°é–‹å§‹</button>
        </div>
        
        <div id="level-complete">
            <h2>æ•‘æ´ç¶²çµ¡å®Œæˆï¼</h2>
            <p>ä½ æˆåŠŸå»ºç«‹äº†é£Ÿç‰©æ•‘æ´ç¶²çµ¡ï¼</p>
            <p>ä½ çš„æœ€çµ‚åˆ†æ•¸æ˜¯: <span id="final-score">0</span>/100</p> <!-- æ·»åŠ äº†ç¸½åˆ†é¡¯ç¤º -->
            <button id="next-level-btn">ä¸‹ä¸€é—œ</button>
        </div>
    </div>

    <div id="music-control">ğŸ”Š</div>

    <audio id="bg-music" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="connect-sound">
        <source src="https://www.soundjay.com/buttons/sounds/button-21.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="error-sound">
        <source src="https://www.soundjay.com/buttons/sounds/button-10.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="complete-sound">
        <source src="https://www.soundjay.com/buttons/sounds/button-20.mp3" type="audio/mpeg">
    </audio>

    <script>
        // éŠæˆ²æ•¸æ“š
        const nodes = [
            { id: 'restaurant1', name: 'æµ·é®®é¤å»³', type: 'source', top: '20%', left: '15%', connections: 2 },
            { id: 'restaurant2', name: 'ç´ é£Ÿé¤å»³', type: 'source', top: '40%', left: '25%', connections: 1 },
            { id: 'supermarket1', name: 'æœ‰æ©Ÿè¶…å¸‚', type: 'source', top: '30%', left: '75%', connections: 2 },
            { id: 'supermarket2', name: 'ç¤¾å€è¶…å¸‚', type: 'source', top: '10%', left: '65%', connections: 1 },
            { id: 'foodbank1', name: 'åŸæ±é£Ÿç‰©éŠ€è¡Œ', type: 'destination', top: '70%', left: '30%', connections: 2 },
            { id: 'foodbank2', name: 'åŸè¥¿é£Ÿç‰©éŠ€è¡Œ', type: 'destination', top: '80%', left: '60%', connections: 2 },
            { id: 'shelter1', name: 'å…’ç«¥åº‡è­·æ‰€', type: 'destination', top: '60%', left: '20%', connections: 1 },
            { id: 'shelter2', name: 'é•·è€…ä¸­å¿ƒ', type: 'destination', top: '50%', left: '80%', connections: 1 }
        ];

        // éŠæˆ²è®Šæ•¸
        let score = 0;
        let resources = 5;
        let connections = [];
        let selectedNode = null;
        let bgMusic = document.getElementById('bg-music');
        let isMusicPlaying = false;

        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            // é‡ç½®éŠæˆ²ç‹€æ…‹
            score = 0;
            resources = 5;
            connections = [];
            selectedNode = null;
            
            // æ›´æ–°UI
            updateUI();
            
            // æ¸…ç©ºåœ°åœ–
            document.getElementById('network-map').innerHTML = '';
            document.getElementById('level-complete').style.display = 'none';
            document.getElementById('controls').style.display = 'flex';
            
            // å‰µå»ºç¯€é»
            createNodes();
            
            // è¨­ç½®éŸ³æ¨‚æ§åˆ¶
            setupMusic();
        }
        
        // è¨­ç½®éŸ³æ¨‚
        function setupMusic() {
            // å˜—è©¦è‡ªå‹•æ’­æ”¾éŸ³æ¨‚ï¼ˆéœ€è¦ç”¨æˆ¶äº’å‹•å¾Œï¼‰
            document.body.addEventListener('click', function() {
                if (!isMusicPlaying) {
                    bgMusic.volume = 0.3;
                    bgMusic.play().then(() => {
                        isMusicPlaying = true;
                        document.getElementById('music-control').textContent = 'ğŸ”Š';
                    }).catch(e => {
                        console.log("è‡ªå‹•æ’­æ”¾è¢«é˜»æ­¢ï¼Œéœ€è¦ç”¨æˆ¶äº’å‹•");
                    });
                }
            }, { once: true });
            
            // éŸ³æ¨‚æ§åˆ¶æŒ‰éˆ•
            document.getElementById('music-control').addEventListener('click', function() {
                if (isMusicPlaying) {
                    bgMusic.pause();
                    this.textContent = 'ğŸ”‡';
                } else {
                    bgMusic.play();
                    this.textContent = 'ğŸ”Š';
                }
                isMusicPlaying = !isMusicPlaying;
            });
        }
        
        // å‰µå»ºç¯€é»
        function createNodes() {
            nodes.forEach(node => {
                const nodeElement = document.createElement('div');
                nodeElement.id = node.id;
                nodeElement.className = `node ${node.type}`;
                nodeElement.style.top = node.top;
                nodeElement.style.left = node.left;
                nodeElement.textContent = node.name;
                
                nodeElement.addEventListener('click', () => selectNode(node.id));
                
                document.getElementById('network-map').appendChild(nodeElement);
            });
        }
        
        // é¸æ“‡ç¯€é»
        function selectNode(nodeId) {
            const node = nodes.find(n => n.id === nodeId);
            const nodeElement = document.getElementById(nodeId);
            
            // å¦‚æœæ²’æœ‰é¸ä¸­çš„ç¯€é»
            if (!selectedNode) {
                // åªèƒ½é¸æ“‡ä¾†æºé»ä½œç‚ºç¬¬ä¸€å€‹ç¯€é»
                if (node.type === 'source' && node.connections > 0) {
                    selectedNode = nodeId;
                    nodeElement.classList.add('selected');
                    document.getElementById('connect-sound').play();
                } else {
                    document.getElementById('error-sound').play();
                }
            } 
            // å¦‚æœå·²ç¶“é¸äº†ä¸€å€‹ç¯€é»
            else {
                const firstNode = nodes.find(n => n.id === selectedNode);
                const firstElement = document.getElementById(selectedNode);
                
                // æª¢æŸ¥æ˜¯å¦é¸æ“‡äº†ä¸åŒçš„ç¯€é»
                if (nodeId !== selectedNode) {
                    // æª¢æŸ¥æ˜¯å¦ç‚ºæœ‰æ•ˆçš„ä¾†æº-ç›®æ¨™é€£æ¥
                    if ((firstNode.type === 'source' && node.type === 'destination') || 
                        (firstNode.type === 'destination' && node.type === 'source')) {
                        
                        // æª¢æŸ¥æ˜¯å¦é‚„æœ‰å¯ç”¨é€£æ¥
                        if (firstNode.connections > 0 && node.connections > 0 && resources > 0) {
                            // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨é€£æ¥
                            const connectionExists = connections.some(conn => 
                                (conn.from === selectedNode && conn.to === nodeId) || 
                                (conn.from === nodeId && conn.to === selectedNode));
                            
                            if (!connectionExists) {
                                // å‰µå»ºé€£æ¥
                                createConnection(selectedNode, nodeId);
                                
                                // æ¸›å°‘å¯ç”¨é€£æ¥æ•¸
                                firstNode.connections--;
                                node.connections--;
                                resources--;
                                
                                // å¢åŠ åˆ†æ•¸ï¼ˆæ”¹ç‚ºæ¯æ¬¡20åˆ†ï¼‰
                                score += 20;
                                document.getElementById('connect-sound').play();
                                
                                // æª¢æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰å¯èƒ½é€£æ¥æˆ–é”åˆ°æ»¿åˆ†
                                if (score >= 100) {
                                    score = 100; // ç¢ºä¿åˆ†æ•¸ä¸è¶…é100
                                    completeLevel();
                                } else {
                                    checkCompletion();
                                }
                            } else {
                                document.getElementById('error-sound').play();
                            }
                        } else {
                            document.getElementById('error-sound').play();
                        }
                    } else {
                        document.getElementById('error-sound').play();
                    }
                }
                
                // é‡ç½®é¸æ“‡
                firstElement.classList.remove('selected');
                selectedNode = null;
                updateUI();
            }
        }
        
        // å‰µå»ºé€£æ¥ç·š
        function createConnection(fromId, toId) {
            const fromElement = document.getElementById(fromId);
            const toElement = document.getElementById(toId);
            
            const fromRect = fromElement.getBoundingClientRect();
            const toRect = toElement.getBoundingClientRect();
            
            const mapRect = document.getElementById('network-map').getBoundingClientRect();
            
            const fromX = fromRect.left - mapRect.left + fromRect.width / 2;
            const fromY = fromRect.top - mapRect.top + fromRect.height / 2;
            const toX = toRect.left - mapRect.left + toRect.width / 2;
            const toY = toRect.top - mapRect.top + toRect.height / 2;
            
            const length = Math.sqrt(Math.pow(toX - fromX, 2) + Math.pow(toY - fromY, 2));
            const angle = Math.atan2(toY - fromY, toX - fromX) * 180 / Math.PI;
            
            const connection = document.createElement('div');
            connection.className = 'connection';
            connection.style.left = fromX + 'px';
            connection.style.top = fromY + 'px';
            connection.style.width = length + 'px';
            connection.style.transform = 'rotate(' + angle + 'deg)';
            
            document.getElementById('network-map').appendChild(connection);
            
            // ä¿å­˜é€£æ¥
            connections.push({
                from: fromId,
                to: toId,
                element: connection
            });
            
            updateUI();
        }
        
        // æª¢æŸ¥æ˜¯å¦å®Œæˆ
        function checkCompletion() {
            // æª¢æŸ¥æ˜¯å¦æ‰€æœ‰ä¾†æºé»éƒ½ç”¨å®Œé€£æ¥
            const allSourcesUsed = nodes.filter(n => n.type === 'source').every(n => n.connections === 0);
            // æˆ–æ‰€æœ‰ç›®æ¨™é»éƒ½ç”¨å®Œé€£æ¥
            const allDestinationsUsed = nodes.filter(n => n.type === 'destination').every(n => n.connections === 0);
            // æˆ–ç”¨å®Œæ‰€æœ‰è³‡æº
            const resourcesUsed = resources === 0;
            
            if (allSourcesUsed || allDestinationsUsed || resourcesUsed) {
                completeLevel();
            }
        }
        
        // å®Œæˆé—œå¡
        function completeLevel() {
            document.getElementById('final-score').textContent = score;
            document.getElementById('level-complete').style.display = 'block';
            document.getElementById('controls').style.display = 'none';
            document.getElementById('complete-sound').play();
        }
        
        // æ›´æ–°UI
        function updateUI() {
            document.getElementById('score-display').textContent = score;
            document.getElementById('connections-display').textContent = connections.length;
            document.getElementById('resources-display').textContent = resources;
            document.getElementById('resource-count').textContent = resources;
        }
        
        // äº‹ä»¶ç›£è½å™¨
        document.getElementById('restart-btn').addEventListener('click', initGame);
        document.getElementById('next-level-btn').addEventListener('click', function() {
            alert('æ­å–œå®Œæˆæœ¬é—œï¼åœ¨å®Œæ•´éŠæˆ²ä¸­å°‡é€²å…¥ä¸‹ä¸€é—œã€‚');
        });
        
        // åˆå§‹åŒ–éŠæˆ²
        initGame();
    </script>
</body>
</html>